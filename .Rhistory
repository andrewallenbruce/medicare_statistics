enroll_1
enroll_1 |>
dplyr::select(Year = year,
Total = enroll_tot_chg,
Original = enroll_orig_chg,
Advantage = enroll_ma_oth_chg) |>
gt::gt(rowname_col = "Year") |>
gt::sub_missing() |>
gt::fmt_number(columns = c("Total", "Original", "Advantage"),
force_sign = TRUE,
decimals = 2,
suffixing = TRUE) |>
gt::opt_stylize(style = 1)
enroll_1
mdcr_enroll_ab_1 <- readr::read_rds(here::here("data", "mdcr_enroll_ab_1.rds"))
mdcr_enroll_ab_2 <- readr::read_rds(here::here("data", "mdcr_enroll_ab_2.rds"))
mdcr_enroll_avgs <- readr::read_rds(here::here("data", "mdcr_enroll_avgs.rds"))
enroll_clean_1 <- mdcr_enroll_ab_1 |>
dplyr::select(year,
total = enroll_tot,
original = enroll_orig,
ma_other = enroll_ma_oth) |>
change_abs(total, year) |>
change_abs(original, year) |>
change_abs(ma_other, year) |>
change_pct(total, total_chg, year) |>
change_pct(original, original_chg, year) |>
change_pct(ma_other, ma_other_chg, year) |>
pct(original, total) |>
pct(ma_other, total) |>
dplyr::mutate(year = as.integer(year))
mdcr_enroll_ab_1
mdcr_enroll_ab_1 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_1")
## https://data.cms.gov/summary-statistics-on-beneficiary-enrollment/medicare-and-medicaid-reports/cms-program-statistics-medicare-total-enrollment
medicare_enrollment <- "https://docs.google.com/spreadsheets/d/11r-Lt-Q3eXRx-wGLxaMF7ymUhZOjsKFSnZDmHp0UWkc/edit#gid=310095942"
mdcr_enroll_ab_1 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_1")
readr::write_rds(mdcr_enroll_ab_1, "data/mdcr_enroll_ab_1.rds", "xz", compression = 9L)
mdcr_enroll_ab_1
enroll_clean_1 <- mdcr_enroll_ab_1 |>
dplyr::select(year,
total = enroll_tot,
original = enroll_orig,
ma_other = enroll_ma_oth) |>
change_abs(total, year) |>
change_abs(original, year) |>
change_abs(ma_other, year) |>
change_pct(total, total_chg, year) |>
change_pct(original, original_chg, year) |>
change_pct(ma_other, ma_other_chg, year) |>
pct(original, total) |>
pct(ma_other, total) |>
dplyr::mutate(year = as.integer(year))
readr::write_rds(mdcr_enroll_ab_1, "data/clean/enroll_clean_1.rds", "xz", compression = 9L)
enroll_1
enroll_1 <- readr::read_rds(here::here("data", "clean", "enroll_clean_1.rds"))
enroll_1
enroll_1
enroll_1
mdcr_enroll_ab_1 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_1")
readr::write_rds(mdcr_enroll_ab_1, "data/mdcr_enroll_ab_1.rds", "xz", compression = 9L)
mdcr_enroll_ab_1
# MDCR ENROLL AB 1.  Total Medicare Enrollment:
# Total, Original Medicare, and Medicare Advantage
# and Other Health Plan Enrollment, Yearly Trend
mdcr_enroll_ab_1 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_1")
mdcr_enroll_ab_1
enroll_clean_1
readr::write_rds(enroll_clean_1, "data/clean/enroll_clean_1.rds", "xz", compression = 9L)
mdcr_enroll_ab_2 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_2")
readr::write_rds(mdcr_enroll_ab_2, "data/mdcr_enroll_ab_2.rds", "xz", compression = 9L)
enroll_clean_2 <- mdcr_enroll_ab_2 |>
dplyr::select(year,
area_of_residence,
population,
total = enroll_tot,
original = enroll_orig,
ma_other = enroll_ma_oth,
metro = enroll_metro,
micro = enroll_micro,
non_cbsa = enroll_non_cbsa) |>
pct(total, population) |>
pct(original, total) |>
pct(ma_other, total) |>
pct(metro, total) |>
pct(micro, total) |>
pct(non_cbsa, total) |>
dplyr::mutate(year = as.integer(year))
readr::write_rds(enroll_clean_2, "data/clean/enroll_clean_2.rds", "xz", compression = 9L)
mdcr_enroll_ab_3 <- googlesheets4::read_sheet(ss = medicare_enrollment, sheet = "mdcr_enroll_ab_3")
readr::write_rds(mdcr_enroll_ab_3, "data/mdcr_enroll_ab_3.rds", "xz", compression = 9L)
enroll_clean_3 <- mdcr_enroll_ab_3 |>
janitor::clean_names() |>
dplyr::mutate(year = as.integer(year)) |>
pct(a_and_or_b_aged, a_and_or_b_tot) |>
pct(a_and_or_b_dsb, a_and_or_b_tot) |>
pct(a_and_b_aged, a_and_b_tot) |>
pct(a_and_b_dsb, a_and_b_tot) |>
pct(a_aged, a_tot) |>
pct(a_dsb, a_tot) |>
pct(b_aged, b_tot) |>
pct(b_dsb, b_tot) |>
change_abs(a_and_or_b_tot, year) |>
change_abs(a_and_b_tot, year) |>
change_abs(a_tot, year) |>
change_abs(b_tot, year) |>
change_pct(a_and_or_b_tot, a_and_or_b_tot_chg, year) |>
change_pct(a_and_b_tot, a_and_b_tot_chg, year) |>
change_pct(a_tot, a_tot_chg, year) |>
change_pct(b_tot, b_tot_chg, year)
readr::write_rds(enroll_clean_3, "data/clean/enroll_clean_3.rds", "xz", compression = 9L)
gc()
#| echo: false
#| eval: true
source(here::here("R", "utils.R"))
source(here::here("R", "enrollment.R"))
enroll_1
enroll_1 |>
dplyr::select(Year = year,
Total = total,
Original = original,
Advantage = ma_other) |>
gt::gt(rowname_col = "Year") |>
gt::sub_missing() |>
gt::fmt_number(columns = c("Total", "Original", "Advantage"),
suffixing = TRUE,
decimals = 2) |>
gt::opt_stylize(style = 1)
enroll_1
enroll_1 |>
dplyr::select(Year = year,
Total = total_chg,
Original = original_chg,
Advantage = ma_other_chg) |>
gt::gt(rowname_col = "Year") |>
gt::sub_missing() |>
gt::fmt_number(columns = c("Total", "Original", "Advantage"),
force_sign = TRUE,
decimals = 2,
suffixing = TRUE) |>
gt::opt_stylize(style = 1)
mdcr_enroll_ab_1
enroll_1 |>
dplyr::select(Year = year,
Total = total_pct_chg,
Original = original_pct_chg,
Advantage = ma_other_pct_chg) |>
gt::gt(rowname_col = "Year") |>
gt::sub_missing() |>
gt::fmt_percent(columns = c("Total", "Original", "Advantage"),
force_sign = TRUE) |>
gt::opt_stylize(style = 1)
enroll_1 |>
dplyr::select(Year = year,
#total,
Original = original,
"Medicare Advantage" = ma_other) |>
tidyr::pivot_longer(!Year,
names_to = "Type",
values_to = "Enrollees") |>
ggplot2::ggplot(ggplot2::aes(Year,
Enrollees,
group = Type,
fill = Type)) +
ggchicklet::geom_chicklet(width = 0.75) +
ggplot2::scale_fill_manual(
name = NULL,
values = c(
"Medicare Advantage" = "#ae4544",
"Economy" = "#d8cb98",
"Climate Change" = "#a4ad6f",
"Original" = "#cc7c3a",
"Healthcare" = "#436f82",
"Foreign Policy" = "#7c5981",
"Other" = "#cccccc"
)
#breaks = setdiff(unique(debates2019$topic), "Other")
) +
ggplot2::guides(
fill = ggplot2::guide_legend(nrow = 1)
) +
ggplot2::coord_flip() +
ggplot2::labs(
x = NULL,
y = NULL,
fill = NULL
) +
hrbrthemes::theme_ipsum_rc(grid="X") +
ggplot2::theme(axis.text.x = ggplot2::element_text(
color = "gray60",
size = 10)) +
ggplot2::theme(legend.position = "top")
enroll_1 |>
dplyr::select(year,
total,
original,
ma_other,
total_chg,
original_chg,
ma_other_chg) |>
dplyr::summarise(n = dplyr::n(),
avg_total = mean(total),
avg_original = mean(original),
avg_ma_other = mean(ma_other),
tot_chg_sum = sum(total_chg, na.rm = TRUE),
avg_tot_chg = tot_chg_sum / n,
orig_chg_sum = sum(original_chg, na.rm = TRUE),
avg_orig_chg = orig_chg_sum / n,
ma_chg_sum = sum(ma_other_chg, na.rm = TRUE),
avg_ma_chg = ma_chg_sum / n) |>
dplyr::select(!c(n, dplyr::contains("sum"))) |>
pct(avg_original, avg_total) |>
pct(avg_ma_other, avg_total) |>
dplyr::glimpse()
mdcr_
enroll_2
#| column: page
enroll_2 |>
dplyr::select(year,
residence = area_of_residence,
Total = total_pct) |>
tidyr::pivot_wider(names_from = "year",
values_from = "Total") |>
gt::gt(rowname_col = "residence") |>
gt::tab_header(
title = gt::md("**Medicare Enrollment by Area of Residence**"),
subtitle = gt::md("**Percentage of Population Enrolled in Medicare, 2013 - 2021**")
) |>
gt::cols_align(align = "right",
columns = residence) |>
gt::cols_align_decimal() |>
# gt::opt_table_font(
#   font = c(
#     gt::google_font(name = "Karla"),
#     gt::default_fonts())) |>
gt::sub_missing() |>
gt::fmt_percent(columns = 2:10,
decimals = 1,
drop_trailing_zeros = TRUE,
drop_trailing_dec_mark = TRUE) |>
gt::data_color(direction = "row",
method = "numeric",
palette = "Blues",
reverse = TRUE) |>
gt::tab_source_note(
source_note = gt::md(
"**Source**: [CMS Program Statistics - Medicare Total Enrollment](https://data.cms.gov/summary-statistics-on-beneficiary-enrollment/medicare-and-medicaid-reports/cms-program-statistics-medicare-total-enrollment).")) |>
gt::opt_stylize(style = 1, add_row_striping = FALSE)
#| column: page
#| echo: false
#| eval: false
enroll_2 |>
dplyr::select(year,
residence = area_of_residence,
ORIG = original_pct,
MA = ma_other_pct) |>
tidyr::pivot_longer(cols = ORIG:MA,
names_to = "Type",
values_to = "Percentage") |>
tidyr::unite("year_type", c(year, Type)) |>
tidyr::pivot_wider(names_from = "year_type",
values_from = "Percentage") |>
gt::gt(rowname_col = "residence") |>
gt::tab_spanner_delim(delim = "_") |>
gt::cols_align(align = "right",
columns = residence) |>
gt::cols_align_decimal() |>
gt::opt_table_font(
font = c(
gt::google_font(name = "Karla"),
gt::default_fonts())) |>
gt::sub_missing() |>
gt::fmt_percent(columns = 2:19,
decimals = 1,
drop_trailing_zeros = TRUE,
drop_trailing_dec_mark = TRUE) |>
gt::data_color(direction = "row",
method = "numeric",
palette = "Blues") |>
gt::opt_vertical_padding(scale = 1.65) |>
gt::opt_stylize(style = 1, add_row_striping = FALSE)
enroll_2 |>
dplyr::select(year,
residence = area_of_residence,
Original = original_pct,
Advantage = ma_other_pct) |>
tidyr::pivot_longer(cols = Original:Advantage,
names_to = "Type",
values_to = "Percentage") |>
tidyr::pivot_wider(names_from = "year",
values_from = "Percentage") |>
gt::gt(rowname_col = "Type",
groupname_col = "residence") |>
gt::opt_stylize(style = 1,
add_row_striping = FALSE) |>
gt::tab_header(
title = gt::md("**Medicare Enrollment by Area of Residence**"),
subtitle = gt::md("**Percentage of Medicare Beneficiaries Enrolled in *Original Medicare* or *Medicare Advantage*, 2013 - 2021**")
) |>
gt::tab_options(
column_labels.vlines.color = "blue",
column_labels.font.weight = "bold",
stub.font.weight = "bold",
stub.font.size = gt::pct(80),
row_group.font.weight = "bold",
row_group.font.size = gt::pct(70),
row_group.as_column = TRUE) |>
gt::cols_align(align = "right",
columns = c("residence", "Type")) |>
gt::cols_align(align = "center",
columns = 3:11) |>
gt::cols_align_decimal() |>
# gt::opt_table_font(
#   font = c(
#     gt::google_font(name = "Karla"),
#     gt::default_fonts())) |>
gt::sub_missing() |>
gt::fmt_percent(columns = 3:11,
decimals = 1,
drop_trailing_zeros = TRUE,
drop_trailing_dec_mark = TRUE) |>
gt::data_color(direction = "row",
method = "numeric",
palette = "Blues") |>
# gt::tab_style(
#   style = gt::cell_fill(color = "lightblue"),
#   locations = gt::cells_row_groups()) |>
gt::opt_vertical_padding(scale = 0.65) |>
gt::tab_source_note(
source_note = gt::md(
"**Source**: [CMS Program Statistics - Medicare Total Enrollment](https://data.cms.gov/summary-statistics-on-beneficiary-enrollment/medicare-and-medicaid-reports/cms-program-statistics-medicare-total-enrollment)."))
enroll_avgs
#| echo: false
#| eval: true
#| message: false
#| warning: false
source(here::here("R", "utils.R"))
source(here::here("R", "deaths.R"))
library(fpp3)
deaths_month <- enroll_33 |>
dplyr::select(year, dplyr::any_of(tolower(month.name))) |>
tidyr::pivot_longer(cols = dplyr::any_of(tolower(month.name)),
names_to = "month",
values_to = "deaths") |>
dplyr::mutate(month = stringr::str_to_title(month),
month = factor(month, levels = month.name),
date = clock::as_date(clock::year_month_day(year, as.integer(month), 1)),
mon = lubridate::month(date, label = TRUE, abbr = TRUE),
type = "Medicare") |>
dplyr::select(type, date, deaths) |>
dplyr::mutate(month = tsibble::yearmonth(date),
date = NULL) |>
tsibble::as_tsibble(index = month)
deaths_month
deaths_qtr <- enroll_33 |>
dplyr::select(year, dplyr::any_of(tolower(month.name))) |>
tidyr::pivot_longer(cols = dplyr::any_of(tolower(month.name)),
names_to = "month",
values_to = "deaths") |>
dplyr::mutate(month = stringr::str_to_title(month),
month = factor(month, levels = month.name),
date = clock::as_date(clock::year_month_day(year, as.integer(month), 1)),
mon = lubridate::month(date, label = TRUE, abbr = TRUE),
type = "Medicare") |>
dplyr::select(type, date, deaths) |>
dplyr::mutate(quarter = tsibble::yearquarter(date),
date = NULL) |>
dplyr::group_by(quarter, type) |>
dplyr::summarise(deaths = sum(deaths), .groups = "drop") |>
tsibble::as_tsibble(index = quarter)
deaths_qtr
#| message: false
#| collapse: true
# Total Beneficiary Deaths by Month, 2008-2021
mon_tot <- enroll_33 |>
dplyr::mutate(group = "Total",
.after = year)
mon_tot
# Original Medicare Beneficiary Deaths by Month, 2008-2021
mon_orig <- enroll_36 |>
dplyr::mutate(group = "Original",
.after = year)
mon_orig
# Medicare Advantage and Other Health Plan Beneficiary Deaths by Month, 2008-2021
mon_ma <- enroll_38 |>
dplyr::mutate(group = "Medicare Advantage",
.after = year)
mon_ma
#| message: false
# ALL Deaths by Month, 2008-2021
deaths_by_month <- dplyr::full_join(mon_tot, mon_orig) |>
dplyr::full_join(mon_ma)
deaths_by_month
deaths_by_month_pct <- deaths_by_month |>
dplyr::select(year,
group,
dplyr::contains("pct"),
-dplyr::contains("chg")) |>
tidyr::pivot_longer(cols = dplyr::contains("pct"),
names_to = "month",
values_to = "deaths_pct") |>
dplyr::mutate(month = stringr::str_remove(month, "_pct"),
month = stringr::str_to_title(month),
month = factor(month, levels = month.name),
date = clock::as_date(clock::year_month_day(year, as.integer(month), 1)),
mon = lubridate::month(date, label = TRUE, abbr = TRUE)) |>
dplyr::select(date, month, mon, year, group, deaths_pct)
deaths_by_month_pct
deaths_by_month_n <- deaths_by_month |>
dplyr::select(year,
group,
dplyr::any_of(tolower(month.name))) |>
tidyr::pivot_longer(cols = dplyr::any_of(tolower(month.name)),
names_to = "month",
values_to = "deaths") |>
dplyr::mutate(month = stringr::str_to_title(month),
month = factor(month, levels = month.name),
date = clock::as_date(clock::year_month_day(year, as.integer(month), 1)),
mon = lubridate::month(date, label = TRUE, abbr = TRUE)) |>
dplyr::select(date, month, mon, year, group, deaths)
deaths_by_month_n
#| warning: false
#| message: false
d_ends <- deaths_by_month_n |>
dplyr::arrange(dplyr::desc(date)) |>
dplyr::slice_head(n = 3) |>
dplyr::pull(deaths)
deaths_by_month_n |>
ggplot2::ggplot(aes(x = date)) +
geom_line(aes(y = deaths, color = group), linewidth = 0.5) +
scale_y_continuous(labels = scales::comma, sec.axis = ggplot2::sec_axis(~ ., breaks = d_ends)) +
gghighlight::gghighlight(deaths > 0, label_key = group, line_label_type = "sec_axis") +
scale_color_manual(name = "", values = c("red","steelblue", "darkgreen")) +
#scalesextra::scale_y_pretty() +
scale_x_date(date_breaks = "1 year", date_labels = "%y", expand = c(0, 0)) +
ggthemes::theme_fivethirtyeight() +
theme(legend.position = "none",
legend.key = element_blank(),
axis.text.y.right = element_text(size = 10, family = "Karla", face = "bold")) +
labs(x = NULL, y = NULL, caption = "Plot by @aabrucehimni")
enroll_35
enroll_37
enroll_39
enroll_34 |>
dplyr::filter(group == "Total") |>
dplyr::select(year, total, original, ma_other)
enroll_34 |>
dplyr::filter(group == "Age Simple") |>
dplyr::select(year, subgroup, total, original, ma_other)
#| echo: false
#| eval: true
source(here::here("R", "utils.R"))
source(here::here("R", "partsab.R"))
enroll_3
age_tot <- enroll_4 |>
dplyr::select(year, dplyr::contains("tot_")) |>
tidyr::pivot_longer(!year, names_to = "group", values_to = "total") |>
dplyr::mutate(group = stringr::str_remove(group, "tot_"),
group = dplyr::case_match(group,
"lt_18" ~ "Under 18",
"18_24" ~ "18-24",
"25_34" ~ "25-34",
"35_44" ~ "35-44",
"45_54" ~ "45-54",
"55_64" ~ "55-64",
"65_74" ~ "65-74",
"75_84" ~ "75-84",
"85_94" ~ "85-94",
"95_gt" ~ "95 and Older"))
age_pct <- enroll_4 |>
dplyr::select(year, dplyr::contains("pct")) |>
tidyr::pivot_longer(!year, names_to = "group", values_to = "percentage") |>
dplyr::mutate(group = stringr::str_remove(group, "pct_"),
group = dplyr::case_match(group,
"lt_18" ~ "Under 18",
"18_24" ~ "18-24",
"25_34" ~ "25-34",
"35_44" ~ "35-44",
"45_54" ~ "45-54",
"55_64" ~ "55-64",
"65_74" ~ "65-74",
"75_84" ~ "75-84",
"85_94" ~ "85-94",
"95_gt" ~ "95 and Older"))
age_groups <- dplyr::left_join(age_tot,
age_pct,
by = dplyr::join_by(year, group))
age_groups |>
tidyr::pivot_longer(cols = total:percentage,
names_to = "type",
values_to = "value") |>
tidyr::pivot_wider(names_from = "year",
values_from = "value") |>
dplyr::filter(type == "total") |>
dplyr::mutate(type = NULL) |>
gt::gt(rowname_col = "group") |>
gt::fmt_number(suffixing = TRUE,
decimals = 0) |>
gt::data_color(direction = "column",
method = "numeric",
palette = "magma",
reverse = F) |>
#gt::opt_stylize(style = 1) |>
gt::tab_options(
table_body.hlines.style = "none",
column_labels.border.top.color = "black",
column_labels.border.bottom.color = "black",
table_body.border.bottom.color = "black"
)
enroll_5
enroll_6
enroll_7
enroll_8
